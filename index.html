<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>one-piece by nozer0</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>one-piece</h1>
        <p>web, js, module, loader, CommonJS, util</p>
        <p class="view"><a href="https://github.com/nozer0/one-piece">View the Project on GitHub <small>nozer0/one-piece</small></a></p>
        <ul>
          <li><a href="https://github.com/nozer0/one-piece/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/nozer0/one-piece/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/nozer0/one-piece">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <hr><pre><code>   _____   __   _   _____        _____   _   _____   _____   _____
  /  _  \ |  \ | | | ____|      |  _  \ | | | ____| /  ___| | ____|
  | | | | |   \| | | |__        | |_| | | | | |__   | |     | |__
  | | | | | |\   | |  __|       |  ___/ | | |  __|  | |     |  __|
  | |_| | | | \  | | |___       | |     | | | |___  | |___  | |___
  \_____/ |_|  \_| |_____|      |_|     |_| |_____| \_____| |_____|
</code></pre>

<hr><h1>
<a name="one-piece" class="anchor" href="#one-piece"><span class="octicon octicon-link"></span></a>One Piece</h1>

<p>Mass of separate web modules.
Collect pieces of small modules together to satisfy different requirements, and with module loader itself,
so call it as 'One Piece', actually, its also my favorite animation name ^_^</p>

<h2>
<a name="module-loader" class="anchor" href="#module-loader"><span class="octicon octicon-link"></span></a>Module Loader</h2>

<h3>
<a name="concepts" class="anchor" href="#concepts"><span class="octicon octicon-link"></span></a>Concepts</h3>

<p>Module is a piece of codes which is offered privacy of their top scope,
facility for importing singleton objects from other modules, and exporting their own APIs.
Please check <a href="http://wiki.commonjs.org/wiki/Modules/1.1.1">commonJS</a> for details.</p>

<p>And for web client, it uses a wrapper function <code>define</code> to implement the feature. Something like</p>

<pre><code>   define('hello', ['util/console'], function(require, exports, module) {
          var console = require('util/console');
          exports.hello = function (name) { console.info('hello ' + name); };
   });
</code></pre>

<h3>
<a name="status" class="anchor" href="#status"><span class="octicon octicon-link"></span></a>Status</h3>

<p>Based on the different situations, one module can have 6 status at different time.</p>

<ol>
<li><p>Uninitialized
   This happens when some modules are first required by their parent module,
   created by the parent module with 'uninitialized' status.</p></li>
<li><p>Loading
   It's easy to understand from naming, the module is under loading currently.</p></li>
<li><p>Loaded &amp; Failed
   The module is loaded successfully or failed.</p></li>
<li><p>Interactive
   All required children modules are ready, which means on the status of 'interactive' or 'complete'.
   But not be executed yet.</p></li>
<li><p>Complete
   When a module tree is ready, it will run the codes from the root module first,
   and when first <code>require</code> function called, the definition of related module is executed,
   and set status to 'complete'.</p></li>
</ol><h3>
<a name="cyclic" class="anchor" href="#cyclic"><span class="octicon octicon-link"></span></a>Cyclic</h3>

<p>About the module require cyclic situation, assume we have such javascript files.
a.js</p>

<pre><code>   define(function (require, exports) {
          console.log('a starting');
          exports.done = false;
          var b = require('./b.js');
          console.log('in a, b.done = %j', b.done);
          exports.done = true;
          console.log('a done');
   });
</code></pre>

<p>b.js</p>

<pre><code>   define(function (require, exports) {
          console.log('b starting');
          exports.done = false;
          var a = require('./a.js');
          console.log('in b, a.done = %j', a.done);
          exports.done = true;
          console.log('b done');
   });
</code></pre>

<p>main.js</p>

<pre><code>   define(function (require, exports) {
          console.log('main starting');
          var a = require('./a.js');
          var b = require('./b.js');
          console.log('in main, a.done=%j, b.done=%j', a.done, b.done);
   });
</code></pre>

<p>We can get the output</p>

<pre><code>   main starting
   a starting
   b starting
   in b, a.done = false
   b done
   in a, b.done = true
   a done
   in main, a.done=true, b.done=true
</code></pre>

<p>The same result as <a href="http://nodejs.org/api/modules.html">nodejs</a></p>

<h3>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h3>

<p>You can simple add a script like.</p>

<pre><code>   &lt;script id="$_" src="path/to/require.js" data-config="./config" data-main="./main"&gt;&lt;/script&gt;
</code></pre>

<p>Or combine normal scripts and 'data-*' attributes feature.</p>

<pre><code>   &lt;script id="$_" src="path/to/require.js" data-config="./config"&gt;&lt;/script&gt;
   &lt;script src="./main.js" defer&gt;&lt;/script&gt;
</code></pre>

<p>Even, although it's highly not encouraged.</p>

<pre><code>   &lt;script id="$_" src="path/to/require.js" data-main="./main"&gt;&lt;/script&gt;
   &lt;script src="./config.js"&gt;&lt;/script&gt;
</code></pre>
      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/nozer0">nozer0</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>